<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Target Bacaan 40 Hari</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Menggunakan latar belakang gelap */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Tailwind gray-900 untuk kontras */
        }
        /* Style untuk animasi loading */
        .loader {
            border: 4px solid #374151; /* gray-700 */
            border-top: 4px solid #facc15; /* yellow-400 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style kustom untuk item to-do */
        .todo-item {
            transition: background-color 0.2s, box-shadow 0.2s;
            cursor: pointer;
            color: #d1fae5; /* emerald-100 */
        }
        .todo-item:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* Style untuk tugas yang sudah selesai */
        .completed {
            background-color: #047857; /* Emerald 700 */
            color: #d1fae5; /* Emerald 100 */
            text-decoration: line-through;
            opacity: 0.8;
        }
        /* Style untuk progres bar */
        #progress-bar {
            transition: width 0.3s ease-in-out;
        }
    </style>
</head>
<body class="p-4 sm:p-8 bg-gray-900">

    <div id="app-container" class="max-w-3xl mx-auto bg-emerald-800 p-6 sm:p-10 rounded-xl shadow-2xl">
        <header class="mb-8 border-b border-emerald-700 pb-4">
            <h1 class="text-3xl font-extrabold text-white mb-1">Target Bacaan 40 Hari</h1>
            <p class="text-emerald-200">Tandai tugas yang sudah selesai. Tugas akan direset otomatis setiap 40 hari.</p>
            <div id="storage-info" class="text-xs text-emerald-300 mt-2">
                Penyimpanan: <span class="font-semibold text-yellow-400">`localStorage`</span>. <span id="reset-status">Memuat status reset...</span>
            </div>
        </header>

        <!-- Progres Bar -->
        <div class="mb-6">
            <h2 class="text-lg font-bold text-white mb-1">Progres Siklus</h2>
            <div class="w-full bg-emerald-700 rounded-full h-3.5">
                <div id="progress-bar" class="bg-yellow-400 h-3.5 rounded-full" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-sm text-emerald-200 mt-1 text-right"></p>
        </div>

        <!-- Loading state -->
        <div id="loading" class="flex justify-center items-center py-10">
            <div class="loader"></div>
            <span class="ml-3 text-emerald-200">Memuat data dan memeriksa status reset 40 hari...</span>
        </div>
        
        <!-- Error message box -->
        <div id="error-message" class="hidden bg-red-800 border border-red-500 text-red-200 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Error:</strong>
            <span id="error-text" class="block sm:inline">Terjadi kesalahan saat memuat atau menyimpan data.</span>
        </div>

        <!-- To-Do List -->
        <div id="todo-list-container" class="hidden">
            <!-- Header List -->
            <div class="grid grid-cols-12 gap-2 text-sm font-semibold text-emerald-300 mb-2 border-b border-emerald-700 pb-2">
                <div class="col-span-1 text-center">#</div>
                <div class="col-span-9">Tugas Bacaan</div>
                <div class="col-span-2 text-center">Status</div>
            </div>

            <!-- List akan di-render di sini -->
            <div id="task-list">
                <!-- Task items will be inserted here by JavaScript -->
            </div>
        </div>

    </div>

    <script>
        // Data list tugas bacaan
        const tasksData = [
            "Halaman 1 (½)", "Halaman 1 (½ → selesai)",
            "Halaman 2 (½)", "Halaman 2 (½ → selesai)",
            "Halaman 3 (½)", "Halaman 3 (½ → selesai)",
            "Halaman 4 (½)", "Halaman 4 (½ → selesai)",
            "Halaman 5 (½)", "Halaman 5 (½ → selesai)",
            "Halaman 6 (½)", "Halaman 6 (½ → selesai)",
            "Halaman 7 (½)", "Halaman 7 (½ → selesai)",
            "Halaman 8 (½)", "Halaman 8 (½ → selesai)",
            "Halaman 9 (½)", "Halaman 9 (½ → selesai)",
            "Halaman 10 (½)", "Halaman 10 (½ → selesai)",
            "Halaman 11 (½)", "Halaman 11 (½ → selesai)",
            "Halaman 12 (½)", "Halaman 12 (½ → selesai)",
            "Halaman 13 (½)", "Halaman 13 (½ → selesai)",
            "Halaman 14 (½)", "Halaman 14 (½ → selesai)",
            "Halaman 15 (½)", "Halaman 15 (½ → selesai)",
            "Halaman 16 (½)", "Halaman 16 (½ → selesai)",
            "Halaman 17 (½)", "Halaman 17 (½ → selesai)",
            "Halaman 18 (½)", "Halaman 18 (½ → selesai)",
            "Halaman 19 (½)", "Halaman 19 (½ → selesai)",
            "Halaman 20 (½)", "Halaman 20 (½ → selesai)"
        ];
        
        // Konstanta untuk siklus reset 40 hari
        const RESET_CYCLE_DAYS = 40;
        const RESET_CYCLE_MS = RESET_CYCLE_DAYS * 24 * 60 * 60 * 1000; // 40 hari dalam milidetik

        // Kunci penyimpanan data di localStorage
        const STORAGE_KEY = 'readingTasks40DayCycle';

        // Status global
        let taskStatus = {};
        let lastResetTimestamp = 0; // Waktu terakhir reset dalam milidetik

        const loadingElement = document.getElementById('loading');
        const todoListContainer = document.getElementById('todo-list-container');
        const taskListElement = document.getElementById('task-list');
        const errorMessageElement = document.getElementById('error-message');
        const errorTextElement = document.getElementById('error-text');
        const resetStatusElement = document.getElementById('reset-status');
        const progressBarElement = document.getElementById('progress-bar');
        const progressTextElement = document.getElementById('progress-text');

        /**
         * Menampilkan pesan error di UI.
         * @param {string} message - Pesan error yang akan ditampilkan.
         */
        function displayError(message) {
            console.error(message);
            errorTextElement.textContent = message;
            errorMessageElement.classList.remove('hidden');
            loadingElement.classList.add('hidden');
            todoListContainer.classList.add('hidden');
        }
        
        /**
         * Menghitung dan memperbarui progres bar siklus 40 hari.
         */
        function updateProgress() {
            const now = Date.now();
            const timeElapsed = now - lastResetTimestamp;
            
            // Hitung hari yang telah berlalu sejak reset terakhir
            const daysElapsed = Math.floor(timeElapsed / (24 * 60 * 60 * 1000));
            
            // Hitung persentase progres
            const progressPercent = Math.min(100, (timeElapsed / RESET_CYCLE_MS) * 100);

            // Perbarui UI
            progressBarElement.style.width = `${progressPercent}%`;
            progressTextElement.textContent = `${daysElapsed} dari ${RESET_CYCLE_DAYS} hari (${progressPercent.toFixed(1)}%)`;
            
            // Perbarui status reset info
            const daysRemaining = RESET_CYCLE_DAYS - daysElapsed;
            if (daysRemaining <= 0) {
                resetStatusElement.textContent = `SIKLUS RESET AKTIF. Tugas akan segera direset.`;
            } else {
                resetStatusElement.textContent = `Siklus reset dalam ${daysRemaining} hari lagi.`;
            }
        }

        /**
         * Menggambar ulang list tugas ke DOM berdasarkan taskStatus.
         */
        function renderTasks() {
            taskListElement.innerHTML = '';
            
            tasksData.forEach((taskName, index) => {
                const taskId = `task-${index + 1}`;
                const isCompleted = taskStatus[taskId] === true;

                const listItem = document.createElement('div');
                listItem.id = taskId;
                listItem.className = `todo-item grid grid-cols-12 gap-2 p-3 my-1 rounded-lg transition duration-150 ease-in-out ${isCompleted ? 'completed' : 'bg-emerald-900 hover:bg-emerald-700'}`;
                listItem.setAttribute('data-task-id', taskId);
                listItem.addEventListener('click', () => toggleTask(taskId));

                // Nomor tugas
                const numCol = document.createElement('div');
                numCol.className = 'col-span-1 text-center font-bold';
                numCol.textContent = index + 1;

                // Nama tugas
                const nameCol = document.createElement('div');
                nameCol.className = 'col-span-9 font-medium truncate';
                nameCol.textContent = taskName;

                // Status checkbox/ikon
                const statusCol = document.createElement('div');
                statusCol.className = 'col-span-2 flex justify-center items-center';
                // Warna ikon disesuaikan dengan skema gelap
                statusCol.innerHTML = isCompleted 
                    ? '<span class="text-yellow-400 text-xl">✔️</span>' // Ikon selesai (Kuning terang)
                    : '<span class="text-emerald-500 text-xl">⬜</span>'; // Ikon belum selesai (Emerald sedang)
                
                listItem.appendChild(numCol);
                listItem.appendChild(nameCol);
                listItem.appendChild(statusCol);

                taskListElement.appendChild(listItem);
            });
            
            // Sembunyikan loading, tampilkan list
            loadingElement.classList.add('hidden');
            todoListContainer.classList.remove('hidden');
            
            // Perbarui progres setiap kali tugas dirender
            updateProgress();
        }

        /**
         * Menyimpan status tugas terbaru ke localStorage.
         */
        function saveTaskStatus() {
            try {
                // Kumpulkan semua data yang akan disimpan
                const dataToSave = {
                    ...taskStatus, // Semua status tugas
                    lastResetTimestamp: lastResetTimestamp // Timestamp terakhir reset
                };

                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
                console.log('Status tugas berhasil disimpan di localStorage.');
                
                // Render ulang setelah sukses menyimpan
                renderTasks();
            } catch (error) {
                displayError("Gagal menyimpan status tugas di localStorage: " + error.message);
            }
        }

        /**
         * Mengganti status selesai tugas dan menyimpannya.
         * @param {string} taskId - ID tugas yang akan di-toggle.
         */
        function toggleTask(taskId) {
            const currentStatus = taskStatus[taskId] === true;
            taskStatus[taskId] = !currentStatus; // Update status lokal
            saveTaskStatus(); // Simpan ke localStorage
        }

        /**
         * Memeriksa dan menjalankan reset 40 hari jika diperlukan.
         * @param {Object} savedData - Data yang dimuat dari localStorage.
         */
        function checkAndPerform40DayReset(savedData) {
            const now = Date.now();
            const loadedTimestamp = savedData.lastResetTimestamp || 0;
            const timeElapsed = now - loadedTimestamp;
            
            const isResetNeeded = timeElapsed >= RESET_CYCLE_MS;

            if (isResetNeeded) {
                // Siklus 40 hari telah berlalu, lakukan reset
                console.log(`Reset 40 hari dipicu. Siklus terakhir: ${new Date(loadedTimestamp).toLocaleString()}.`);
                
                // Inisialisasi status tugas baru (semua false)
                const initialTasks = tasksData.reduce((acc, _, index) => {
                    acc[`task-${index + 1}`] = false;
                    return acc;
                }, {});
                
                taskStatus = initialTasks;
                lastResetTimestamp = now; // Set timestamp reset baru
                
                // Simpan status reset dan timestamp baru ke localStorage
                saveTaskStatus();
                console.log("Status tugas berhasil direset dan disimpan untuk siklus baru.");
                
            } else {
                // Belum waktunya reset
                console.log("Tidak perlu reset 40 hari. Tugas dipertahankan.");
                
                // Isi taskStatus dengan data tugas yang tersimpan (kecuali lastResetTimestamp)
                taskStatus = Object.keys(savedData).reduce((acc, key) => {
                    if (key !== 'lastResetTimestamp') {
                        acc[key] = savedData[key];
                    }
                    return acc;
                }, {});
                
                lastResetTimestamp = loadedTimestamp;
            }

            // Pastikan semua task ID memiliki entri di taskStatus
            tasksData.forEach((_, index) => {
                const taskId = `task-${index + 1}`;
                if (taskStatus[taskId] === undefined) {
                    taskStatus[taskId] = false;
                }
            });
            
            // Setelah reset/load, render tugas
            renderTasks();
        }

        /**
         * Memuat data tugas dari localStorage.
         */
        function loadData() {
            try {
                const storedData = localStorage.getItem(STORAGE_KEY);
                let savedData = {};

                if (storedData) {
                    savedData = JSON.parse(storedData);
                    console.log("Data dimuat dari localStorage:", savedData);
                } else {
                    console.log("Data tidak ditemukan di localStorage, inisialisasi data baru.");
                }

                // Cek dan lakukan reset jika diperlukan
                checkAndPerform40DayReset(savedData);

            } catch (error) {
                displayError("Gagal memuat atau memproses data dari localStorage: " + error.message);
                // Inisialisasi default jika terjadi error
                checkAndPerform40DayReset({});
            }
        }

        // Jalankan inisialisasi aplikasi saat DOM siap
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
